{
  "name": "Tweet Categorization to Notion",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "event": "page",
        "databaseId": "YOUR_NOTION_DATABASE_ID",
        "options": {
          "filters": {
            "conditions": [
              {
                "property": "Processing Status",
                "condition": "equals",
                "value": "Pending"
              }
            ]
          }
        }
      },
      "id": "notion-trigger",
      "name": "Notion Trigger",
      "type": "n8n-nodes-base.notionTrigger",
      "typeVersion": 2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "=https://api.vxtwitter.com/Twitter/status/{{ $json.properties.URL.url.split('/').pop() }}",
        "options": {}
      },
      "id": "fetch-tweet",
      "name": "Fetch Tweet Content",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [470, 300],
      "notes": "Using vxtwitter API - free, no auth needed"
    },
    {
      "parameters": {
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "resource": "message",
        "model": "claude-haiku-4-5-20251001",
        "prompt": "=Analyze this tweet about nano banana pro prompts and provide a structured response.\n\nTweet Author: {{ $json.user_name }}\nTweet Text: {{ $json.text }}\nTweet URL: {{ $('Notion Trigger').item.json.properties.URL.url }}\n\nProvide your response in this exact JSON format:\n{\n  \"category\": \"<one of: Technique|Use Case|Tips|Examples|Tutorial|Inspiration|Discussion>\",\n  \"tags\": [\"<tag1>\", \"<tag2>\", \"<tag3>\"],\n  \"description\": \"<concise 1-2 sentence description>\",\n  \"prompt\": \"<the actual nano banana pro prompt if present, otherwise empty string>\",\n  \"author\": \"{{ $json.user_name }}\"\n}\n\nIMPORTANT - Prompt Extraction:\n- Look for the actual nano banana pro prompt in the tweet\n- Prompts are often in quotes, code blocks, or clearly formatted\n- Extract the complete prompt text exactly as written\n- If the tweet discusses prompts but doesn't contain an actual prompt, leave empty\n- If multiple prompts, extract the primary/main one\n\nFocus on:\n- What aspect of nano banana pro prompts this covers\n- Key techniques or insights mentioned\n- Practical application value\n\nRespond ONLY with valid JSON, no other text.",
        "options": {
          "maxTokens": 500,
          "temperature": 0.3
        }
      },
      "id": "claude-analysis",
      "name": "Claude Analysis",
      "type": "@n8n/n8n-nodes-langchain.lmChatAnthropic",
      "typeVersion": 1,
      "position": [690, 300]
    },
    {
      "parameters": {
        "jsCode": "// Parse Claude's response and prepare for Notion\nconst claudeResponse = $input.item.json.response || $input.item.json.message?.content?.[0]?.text;\n\nlet analysis;\ntry {\n  // Remove markdown code blocks if present\n  const cleanJson = claudeResponse.replace(/```json\\n?|```/g, '').trim();\n  analysis = JSON.parse(cleanJson);\n} catch (error) {\n  // Fallback if JSON parsing fails\n  analysis = {\n    category: \"Uncategorized\",\n    tags: [\"needs-review\"],\n    description: \"Failed to parse analysis\",\n    prompt: \"\",\n    author: $('Fetch Tweet Content').item.json.user_name || \"Unknown\"\n  };\n}\n\n// Get original tweet data\nconst tweetData = $('Fetch Tweet Content').item.json;\nconst notionData = $('Notion Trigger').item.json;\n\nreturn {\n  json: {\n    pageId: notionData.id,\n    category: analysis.category,\n    tags: analysis.tags,\n    description: analysis.description,\n    prompt: analysis.prompt || \"\",\n    tweetContent: tweetData.text || \"\",\n    author: tweetData.user_name || analysis.author || \"Unknown\",\n    tweetUrl: notionData.properties.URL.url\n  }\n};"
      },
      "id": "parse-response",
      "name": "Parse Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [910, 300]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": "={{ $json.pageId }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Category",
              "type": "select",
              "selectValue": "={{ $json.category }}"
            },
            {
              "key": "Tags",
              "type": "multiSelect",
              "multiSelectValue": "={{ $json.tags }}"
            },
            {
              "key": "Description",
              "type": "richText",
              "richText": "={{ $json.description }}"
            },
            {
              "key": "Prompt",
              "type": "richText",
              "richText": "={{ $json.prompt }}"
            },
            {
              "key": "Tweet Content",
              "type": "richText",
              "richText": "={{ $json.tweetContent }}"
            },
            {
              "key": "Author",
              "type": "richText",
              "richText": "={{ $json.author }}"
            },
            {
              "key": "Processing Status",
              "type": "select",
              "selectValue": "Processed"
            },
            {
              "key": "Date Processed",
              "type": "date",
              "date": "={{ $now.toISO() }}"
            }
          ]
        }
      },
      "id": "update-notion",
      "name": "Update Notion",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [1130, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.error }}",
              "operation": "isEmpty"
            }
          ]
        }
      },
      "id": "check-success",
      "name": "Check Success",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [690, 500],
      "notes": "Error handling branch"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": "={{ $('Notion Trigger').item.json.id }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "Processing Status",
              "type": "select",
              "selectValue": "Error"
            },
            {
              "key": "Description",
              "type": "richText",
              "richText": "=Failed to process: {{ $json.error || 'Unknown error' }}"
            }
          ]
        }
      },
      "id": "mark-error",
      "name": "Mark as Error",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [910, 600]
    }
  ],
  "connections": {
    "Notion Trigger": {
      "main": [
        [
          {
            "node": "Fetch Tweet Content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Tweet Content": {
      "main": [
        [
          {
            "node": "Claude Analysis",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Success",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Analysis": {
      "main": [
        [
          {
            "node": "Parse Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Response": {
      "main": [
        [
          {
            "node": "Update Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Success": {
      "main": [
        [],
        [
          {
            "node": "Mark as Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {}
}
